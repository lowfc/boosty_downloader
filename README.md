[<img src="assets/head.svg">](https://github.com/lowfc/boosty_downloader/releases)

![GitHub stars](https://img.shields.io/github/stars/lowfc/boosty_downloader?style=flat-square)
![GitHub issues](https://img.shields.io/github/issues/lowfc/boosty_downloader?style=flat-square)
![Python](https://img.shields.io/badge/Python-3.10-blue?logo=python&style=flat-square)

---

Приложение предназначено для синхронизации вашего контента между boosty.to и компьютером. Синхронизация может выполняться в двух режимах: для медиа и для постов.

Используя приложение, вы подтверждаете согласие с [пользовательским соглашением](assets/user_agreement.txt).


## Режимы синхронизации

### Режим синхронизации медиа
- Приложение создаст папку автора по указанному пути и поместит туда директории photos, videos и audios;
- Приложение скачает весь **_доступный вам_** медиаконтент с указанной страницы автора на boosty.to в соответствующие директории, созданные в предыдущем пункте;
- При последующих синхронизациях приложение будет добавлять в эти директории новый контент, если таковой найдется.

### Режим синхронизации постов
- Приложение создаст папку автора по указанному пути и поместит туда директорию posts;
- Приложение скачает весь **_доступный вам_** медиаконтент, а так же текст поста (в .txt или .md формате) и прикрепленные файлы с указанной страницы автора на boosty.to, группируя контент по постам в соответствующие директории;
- При последующих синхронизациях приложение будет добавлять в posts новые посты, если таковые найдутся.

Если вам нужно синхронизировать конкретный пост, запустите приложение с параметром `-p <id поста>`
например:

```shell
./boosty_downloader.exe -p e87f6e1b-67ab-4fd0-9633-f8efe4ad1990
```

### Дополнительная информация

- Если вы переименуете, или удалите файлы, или посты - при следующей синхронизации они будут загружены снова.
- Вы можете синхронизировать контент без авторизации, но в таком случае будет недоступно скачивание закрытых медиафайлов (фото, видео). А так же будет недоступна загрузка вообще всех аудио и прикрепленных к постам файлов, даже если они не приватные.


## Установка и запуск

### Запуск сборки (рекомендуется)

Только для windows. Если у вас linux, воспользуйтесь инструкцией из блока [Запуск проекта](#запуск-проекта).

1. Перейдите на [страницу релизов](https://github.com/lowfc/boosty_downloader/releases);
2. Скачайте последний релиз и распакуйте в удобную для вас папку;
3. Перейдите в папку с приложением;
4. Заполните конфиг по инструкции из блока [Конфигурация](#Конфигурация);
5. Запустите файл boosty_downloader_x.x.x.exe двойным щелчком, или через терминал.

### Конфигурация
1. Переименуйте конфиг из `config.yml.example` в `config.yml`;
2. Откройте конфиг любым текстовым редактором;
3. Введите корневую директорию для синхронизации в поле file => sync_dir. В ней будут созданы папки авторов:
4. Заполните нужные поля конфига. Ниже приведено описание всех полей.

| Блок    | Название поля          | Описание                                                                                                                    | Пример                                                  | Обязательное |
|---------|------------------------|-----------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|--------------|
| auth    | cookie                 | Cookie boosty, получите по инструкции из блока [Получение Cookie и Authorization](#Получение-Cookie-и-Authorization)        | _clientId=3272e99d-ecb4-452c-bf05-eba31347ec39; _ga=... | Нет          |
| auth    | authorization          | Authorization boosty, получите по инструкции из блока [Получение Cookie и Authorization](#Получение-Cookie-и-Authorization) | Bearer ...                                              | Нет          |
| file    | sync_dir               | Корневая папка синхронизации, в ней будут созданы папки авторов                                                             | C://boosty_dumps                                        | **Да**       |
| file    | download_chunk_size    | Размер чанка загрузки, байты                                                                                                | 153600                                                  | Нет          |
| file    | download_timeout       | Максимальное время загрузки одного файла, секунды                                                                           | 3600                                                    | Нет          |
| file    | max_download_parallel  | Максимальное количество одновременно загружаемых файлов                                                                     | 5                                                       | Нет          |
| file    | sync_offset_save       | Сохранять последний offset в конце синхронизации для ускорения получения данных в следующих синхронизациях (true/false)     | false                                                   | Нет          |
| file    | enable_post_masquerade | Называть папку поста заголовком поста (true/false)                                                                          | true                                                    | Нет          |
| file    | max_video_file_size    | Максимальный размер загружаемых видео: low, medium, high, full_hd, ultra_hd, no_restrict                                    | no_restrict                                             | Нет          |
| content | storage_type           | Тип синхронизации: [media](#Режим-синхронизации-медиа) или [post](#Режим-синхронизации-постов)                              | media                                                   | **Да**       |
| content | post_text_in_markdown  | Сохранять текст постов в markdown (true/false)                                                                              | true                                                    | Нет          |
| content | save_metadata          | Сохранять метаданные видео (true/false)                                                                                     | false                                                   | Нет          |
| content | collect                | Список типов контента, которые нужно сохранять: photos, videos, audios, files. Можно указать все, или несколько.            | - photos<br>- videos<br>- audios<br>- files             | **Да**       |
| logging | enable_file_logging    | Сохранять лог в файл                                                                                                        | false                                                   | Нет          |
| logging | logs_path              | Путь к директории логов                                                                                                     | C://boosty_logs                                         | Нет          |

### Получение Cookie и Authorization

#### Вариант 1 (простой)
1. Перейдите на страницу boosty.to;
2.  Войдите в свой аккаунт на boosty.to;
3.  Нажмите клавишу `F12`;
4.  Перейдите в раздел Console (Консоль);
5. В поле ввода консоли введите следующий код и нажмите Enter:

```
const full_cookie=`${document.cookie}`;function getCookie(o,e){const l=e.split(`; ${o}=`);if(2===l.length)return l.pop().split(";").shift()}function parseAuthCookie(o){if(void 0===o)return;let e=o.replaceAll("%7B","{");e=e.replaceAll("%22",'"'),e=e.replaceAll("%3A",":"),e=e.replaceAll("%2C",","),e=e.replaceAll("%7D","}");let l=JSON.parse(e).accessToken;return void 0!==l?"Bearer "+l:void 0}const auth_token=getCookie("auth",full_cookie);void 0===auth_token?console.log("Не получилось найти данные авторизации. Вы точно вошли в аккаунт?"):console.log(`\n\nCookie:\n\n${full_cookie}\n\nAuthorization:\n\n${parseAuthCookie(auth_token)}\n\n`);
```
**При вставке кода в консоль, браузер может показать предупреждение о вставке кода. В таком случае, перед вставкой кода, введите в консоль то, что просит браузер, например: "разрешить вставку", нажмите Enter, а уже потом выполняйте вставку кода и снова нажимайте Enter.**

В консоли появится текст вида:

```
Cookie:

<То, что нужно вставить в поле auth -> cookie конфига приложения>

Authorization:

<То, что нужно вставить в поле auth -> authorization конфига приложения>
```

Вставьте соответствующий текст в соответствующие поля конфига. **Держите содержимое этих параметров в секрете!** Если через какое-то время приложение перестало скачивать контент, попробуйте обновить значения полей в конфиге, по инструкции выше.
  
##### Вариант 2
1. Перейдите на вашу страницу на boosty.to;
2. Войдите в свой аккаунт на boosty.to;
3. Нажмите клавишу `F12`;
4. Перейдите в раздел Network (Сеть);
5. Обновите страницу с помощью `Shift + F5` (важно нажимать именно `Shift + F5`, что бы сбросить кеш браузера, иначе Cookie и Authorization вы можете не увидеть);
6. Прокрутите страницу вниз, пока сайт не подгрузит больше постов;
7. В списке запросов, выберите найдите запрос вида: post/?limit=5&offset=...
8. В блоке Request Headers найдите Authorization и Cookie, а затем скопируйте их в соответствующие поля в config.yml.

**Держите содержимое этих параметров в секрете!** Если через какое-то время приложение перестало скачивать контент, попробуйте обновить значения полей в конфиге, по инструкции выше.

### Запуск проекта

Запускайте с python версии 3.10.

- #### Откройте терминал;

- #### Клонируйте последнюю версию приложения:
```shell
git clone https://github.com/lowfc/boosty_downloader
```

- #### Перейдите в корневую директорию приложения:
```shell
cd boosty_downloader
```

- #### Создайте venv:
```shell
python3 -m venv venv
```

- #### Активируйте venv:
_win:_
```shell
.\venv\Scripts\activate
```

_linux:_
```shell
source ./venv/bin/activate
```

- #### Установите зависимости:
```shell
pip install -r requirements.txt
```

- #### Заполните конфиг:
Заполните конфиг по инструкции из блока [Конфигурация](#Конфигурация)

- #### Запустите:
```shell
python main.py
```


## Сборка приложения

Приложение собирается с помощью pyinstaller.

Находясь в корневой директории приложения,

#### 1. Создайте venv:

```shell
python3 -m venv venv
```

#### 2. Активируйте venv:

_win:_
```shell
.\venv\Scripts\activate
```

_linux:_
```shell
source ./venv/bin/activate
```

#### 3. Установите pyinstaller:

```shell
pip install pyinstaller
```

#### 4. Соберите проект:

```shell
pyinstaller --onefile --icon=assets/logo.ico main.py
```
