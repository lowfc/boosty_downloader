# Boosty downloader

- Приложение скачает весь **_доступный вам_** медиаконтент со страницы автора на boosty.to;

- Приложение предназначено для скачивания **_вашего контента_** с **_вашей страницы boosty_**, 
автор не несет ответственность за нецелевое использование приложения;

- **Это не хак-тул**! Приложение скачает только тот контент, к которому вы имеете доступ на сайте boosty.to.


## Как это работает

Приложение создаст папку с названием, совпадающим с user_name автора на boosty и синхронизирует туда контент. Способ синхронизации зависит от настроек приложения:

- В случае синхронизации в режиме медиа (storage_type: media):
Приложение скачает все доступные фото, видео и аудио (в раздельные директории внутри папки автора). Приложение попытается скачать контент в самом высоком из доступных разрешений. При повторном запуске,
уже скачанный контент будет игнорироваться, а новый добавляться в соответствующие директории.
- В случае синхронизации по постам (storage_type: post):
Приложение создаст папку posts в папке автора. В папку posts будут синхронизироваться посты автора. Один пост - одна папка. Название папки совпадает с ID поста. 
Внутри папки поста будут созданы директории для фото, видео, аудио и файлов. Синхронизация в них будет производиться аналогично storage_type: media.
Так же в каждой паке поста будет создан файл contents - в него будет записываться текст поста. В конфиге приложения можно выбрать формат сохранения текста: txt или md.

Не переименовывайте и не удаляйте директории и файлы, созданные приложением, иначе при следующей синхронизации они будут скачаны снова.

**Важно: Вы можете синхронизировать контент без авторизации (без указания куков браузера в конфиге приложения), но в таком случае будет недоступно скачивание закрытых медиафайлов (фото, видео) и вообще любых аудио и прикрепленных к постам файлов. Это особенность работы boosty.to**


## Установка и запуск

### Запуск сборки (рекомендуется)

#### Только для windows! Если у вас linux, воспользуйтесь инструкцией из блока [Запуск проекта](#запуск-проекта).

1. #### Перейдите на [страницу релизов](https://github.com/lowfc/boosty_downloader/releases);
2. #### Скачайте последний релиз и распакуйте в удобную для вас папку;
3. #### Перейдите в папку с приложением;
4. #### Заполните конфиг по инструкции из блока [Конфигурация](#Конфигурация);
5. #### Запустите файл boosty_downloader_x.x.x.exe двойным щелчком, или через терминал. 

#### Для того, что бы синхронизировать конкретный пост:
1. В конфиге установите режим синхронизации по постам (storage_type: post);
2. Запустите программу в терминале с параметром -p <id поста>

Например:

```shell
./boosty_downloader.exe -p e87f6e1b-67ab-4fd0-9633-f8efe4ad1990
```

### Конфигурация
1. В корневой директории приложения создайте файл config.yml и скопируйте в него содержимое файла config.yml.example, или воспользуйтесь терминалом:

win:
```shell
copy .\config.yml.example .\config.yml
```

linux:
```bash
cp ./config.yml.example ./config.yml
```

2. Откройте только что созданный файл config.yml;
3. Введите корневую директорию для синхронизации в поле file => sync_dir. В ней будут созданы папки авторов:

```yaml
file:
  sync_dir: 'C:\boosty_dumps' <== путь к папке, где будут созданы папки авторов
```

4. Если хотите скачать закрытый (но доступный вам) контент, заполните поле auth => cookie и auth => authorization (ниже описана инструкция по получению этих данных):

```yaml
auth:
  cookie: '_clientId=bfecec25-182d-4c1b-ae56-c4ad122782c1; _ga=...'
  authorization: 'Bearer ...'
```

5. Установите необходимый способ синхронизации в content => storage_type (media или post):

```yaml
content:
  # Тип синхронизации: post или media
  storage_type: media
```

6. Если какой-то из типов контента вам не нужен, удалите (или закомментируйте с помощью #) соответствующую строчку в списке content => collect:

```yaml
content:
  storage_type: media
  post_text_in_markdown: true
  collect:
    - videos
    - photos
    # audios
    # files
```

_В примере выше включена синхронизация видео и фото, и отключена синхронизация аудио и файлов._

7. Если лог синхронизации нужно сохранять в файл, заполните блок logging.

**Прикрепленные к постам файлы (например: PDF, PPTP, пр.) будут скачаны только в режиме синхронизации post.**

**Для синхронизации прикрепленных к постам файлов, и аудиофайлов (в любом режиме синхронизации) необходимо заполнить поля auth => cookie и auth => authorization в конфиге!**

### Получение Cookie и Authorization

#### Вариант 1 (простой)
- Перейдите на страницу boosty.to;
- Войдите в свой аккаунт на boosty.to;
- Нажмите клавишу `F12`;
- Перейдите в раздел Console (Консоль);
- В поле ввода консоли введите следующий код и нажмите Enter:

```
const full_cookie=`${document.cookie}`;function getCookie(o,e){const l=e.split(`; ${o}=`);if(2===l.length)return l.pop().split(";").shift()}function parseAuthCookie(o){if(void 0===o)return;let e=o.replaceAll("%7B","{");e=e.replaceAll("%22",'"'),e=e.replaceAll("%3A",":"),e=e.replaceAll("%2C",","),e=e.replaceAll("%7D","}");let l=JSON.parse(e).accessToken;return void 0!==l?"Bearer "+l:void 0}const auth_token=getCookie("auth",full_cookie);void 0===auth_token?console.log("Не получилось найти данные авторизации. Вы точно вошли в аккаунт?"):console.log(`\n\nCookie:\n\n${full_cookie}\n\nAuthorization:\n\n${parseAuthCookie(auth_token)}\n\n`);
```
**При вставке кода в консоль, браузер может показать предупреждение о вставке кода. В таком случае, перед вставкой кода, введите в консоль то, что просит браузер, например: "разрешить вставку", нажмите Enter, а уже потом выполняйте вставку кода и снова нажимайте Enter.**

- В консоли появится текст вида:

```
Cookie:

<То, что нужно вставить в поле auth -> cookie конфига приложения>

Authorization:

<То, что нужно вставить в поле auth -> authorization конфига приложения>
```

- Вставьте соответствующий текст в соответствующие поля конфига.
  
##### Вариант 2
- Перейдите на вашу страницу на boosty.to;
- Войдите в свой аккаунт на boosty.to;
- Нажмите клавишу `F12`;
- Перейдите в раздел Network (Сеть);
- Обновите страницу с помощью `Shift + F5` (важно нажимать именно `Shift + F5`, что бы сбросить кеш браузера, иначе Cookie и Authorization вы можете не увидеть);
- Прокрутите страницу вниз, пока сайт не подгрузит больше постов;
- В списке запросов, выберите найдите запрос вида: post/?limit=5&offset=...
- В блоке Request Headers найдите Authorization и Cookie, а затем скопируйте их в соответствующие поля в config.yml.

**Держите содержимое этих параметров в секрете!**

Если через какое-то время приложение перестало скачивать контент, попробуйте обновить значения полей в конфиге, по инструкции выше.

### Запуск проекта

Запускайте с python версии 3.10 или выше.

- #### Откройте терминал;

- #### Клонируйте последнюю версию приложения:
```shell
git clone https://github.com/lowfc/boosty_downloader
```

- #### Перейдите в корневую директорию приложения:
```shell
cd boosty_downloader
```

- #### Создайте venv:
```shell
python3 -m venv venv
```

- #### Активируйте venv:
_win:_
```shell
.\venv\Scripts\activate
```

_linux:_
```shell
source ./venv/bin/activate
```

- #### Установите зависимости:
```shell
pip install -r requirements.txt
```

- #### Заполните конфиг:
Заполните конфиг по инструкции из блока [Конфигурация](#Конфигурация)

- #### Запустите:
```shell
python main.py
```

### Сборка приложения

Приложение собирается с помощью pyinstaller.

Находясь в корневой директории приложения,

#### 1. Создайте venv:

```shell
python3 -m venv venv
```

#### 2. Активируйте venv:

_win:_
```shell
.\venv\Scripts\activate
```

_linux:_
```shell
source ./venv/bin/activate
```

#### 3. Установите pyinstaller:

```shell
pip install pyinstaller
```

#### 4. Соберите проект:

```shell
pyinstaller --onefile --icon=logo.ico main.py
```
